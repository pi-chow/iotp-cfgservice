<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cetiti.iotp.cfgservice.mapper.AlarmMapper">
    
    <select id="deviceAlarmList" parameterType="java.util.Map"
            resultType="com.cetiti.iotp.cfgservice.domain.ExceptionAlarm">
        SELECT tea.*,tdm.device_model_name
        FROM t_exception_alarm tea LEFT JOIN t_device_model tdm ON tea.device_model = tdm.device_model
        <where>
            <if test="deviceModel != null">
                AND tea.device_model = #{deviceModel}
            </if>
            <if test="deviceSn != null">
                AND tea.device_sn LIKE CONCAT('%',#{deviceSn},'%')
            </if>
            <if test="startTime != null">
                AND <![CDATA[ tea.create_time > #{startTime,jdbcType=TIMESTAMP}]]>
            </if>
            <if test="endTime != null">
                AND <![CDATA[ tea.create_time < #{endTime,jdbcType=TIMESTAMP}]]>
            </if>
            <if test="conditions != null">
                AND tea.conditions LIKE CONCAT('%',#{conditions},'%')
            </if>
            <if test="userId != null">
                AND tdm.create_user_id = #{userId}
            </if>
        </where>
    </select>

    <select id="alarmCountByModel" parameterType="HashMap" resultType="Integer">
        SELECT COUNT(id)
        FROM t_exception_alarm
        WHERE device_model = #{deviceModel}
    </select>
</mapper>