<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cetiti.iotp.cfgservice.mapper.AlarmMapper">
    
    <select id="deviceAlarmList" parameterType="java.util.Map"
            resultType="com.cetiti.iotp.cfgservice.domain.ExceptionAlarm">
        SELECT id,device_model,device_sn,`value`,alarm,create_time,conditions,indexCode,alarm_level
        FROM t_exception_alarm
        <where>
            <if test="deviceModel != null">
                AND device_model = #{deviceModel}
            </if>
            <if test="deviceSn != null">
                AND device_sn LIKE CONCAT('%',#{deviceSn},'%')
            </if>
            <if test="startTime != null">
                AND create_time &gt; #{startTime}
            </if>
            <if test="endTime != null">
                AND create_time &lt; #{endTime}
            </if>
            <if test="conditions != null">
                AND conditions LIKE CONCAT('%',#{conditions},'%')
            </if>
        </where>
    </select>

    <select id="alarmCountByModel" parameterType="HashMap" resultType="Integer">
        SELECT COUNT(id)
        FROM t_exception_alarm
        WHERE device_model = #{deviceModel}
    </select>
</mapper>