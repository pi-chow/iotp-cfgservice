<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cetiti.iotp.cfgservice.mapper.AlarmMapper">
    
    <select id="deviceAlarmList" parameterType="java.util.Map"
            resultType="com.cetiti.iotp.cfgservice.domain.ExceptionAlarm">
        SELECT a.*,b.device_model_name
        FROM t_exception_alarm a LEFT JOIN t_device_model b ON a.device_model = b.device_model
        <where>
            <if test="deviceModel != null">
                AND a.device_model = #{deviceModel}
            </if>
            <if test="deviceSn != null">
                AND a.device_sn LIKE CONCAT('%',#{deviceSn},'%')
            </if>
            <if test="startTime != null">
                AND a.create_time &gt; #{startTime}
            </if>
            <if test="endTime != null">
                AND a.create_time &lt; #{endTime}
            </if>
            <if test="conditions != null">
                AND a.conditions LIKE CONCAT('%',#{conditions},'%')
            </if>
        </where>
    </select>

    <select id="alarmCountByModel" parameterType="HashMap" resultType="Integer">
        SELECT COUNT(id)
        FROM t_exception_alarm
        WHERE device_model = #{deviceModel}
    </select>
</mapper>